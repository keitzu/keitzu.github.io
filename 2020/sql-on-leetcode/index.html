

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" type="image/png" href="/img/favicon.ico">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="柯梓">
  <meta name="keywords" content="">
  <title>LeetCode部分SQL习题（一） - 柯梓的四叠半世界</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"keitzu.com","root":"/","version":"1.8.6","typing":{"enable":true,"typeSpeed":50,"cursorChar":"","loop":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":3},"anchorjs":{"enable":false,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"copy_btn":true,"image_zoom":{"enable":true},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>柯梓的四叠半世界</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('https://static.kezi.xyz/images/background/bg-fa74fc6.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="LeetCode部分SQL习题（一）">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-08-20 10:26" pubdate>
        2020年8月20日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.3k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      32
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">LeetCode部分SQL习题（一）</h1>
            
            <div class="markdown-body">
              <p>SQL是一种特定目的编程语言，用于管理关系数据库管理系统（RDBMS），或在关系流数据管理系统（RDSMS）中进行流处理。<br><a id="more"></a></p>
<h3 id="175-组合两个表"><a href="#175-组合两个表" class="headerlink" title="175. 组合两个表"></a>175. 组合两个表</h3><h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">表1: Person<br><span class="hljs-code">+-------------+</span>---------+<br>| 列名         | 类型     |<br><span class="hljs-code">+-------------+</span>---------+<br>| PersonId    | int     |<br>| FirstName   | varchar |<br>| LastName    | varchar |<br><span class="hljs-code">+-------------+</span>---------+<br>PersonId 是上表主键<br></code></pre></td></tr></table></figure>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">表2: Address<br><span class="hljs-code">+-------------+</span>---------+<br>| 列名         | 类型    |<br><span class="hljs-code">+-------------+</span>---------+<br>| AddressId   | int     |<br>| PersonId    | int     |<br>| City        | varchar |<br>| State       | varchar |<br><span class="hljs-code">+-------------+</span>---------+<br>AddressId 是上表主键<br></code></pre></td></tr></table></figure>
<p>编写一个 SQL 查询，满足条件：无论 person 是否有地址信息，都需要基于上述两表提供 person 的以下信息：<br><code>FirstName, LastName, City, State</code></p>
<p>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/combine-two-tables">LeetCode</a></p>
<h4 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT FirstName, LastName, City, State<br>FROM Person<br>LEFT JOIN Address<br>ON Person.PersonId &#x3D; Address.PersonId<br></code></pre></td></tr></table></figure>
<h3 id="176-第二高的薪水"><a href="#176-第二高的薪水" class="headerlink" title="176. 第二高的薪水"></a>176. 第二高的薪水</h3><h4 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h4><p>编写一个 SQL 查询，获取 Employee 表中第二高的薪水（Salary） 。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+----+</span>--------+<br>| Id | Salary |<br><span class="hljs-code">+----+</span>--------+<br>| 1  | 100    |<br>| 2  | 200    |<br>| 3  | 300    |<br><span class="hljs-code">+----+</span>--------+<br></code></pre></td></tr></table></figure><br>例如上述 Employee 表，SQL查询应该返回 200 作为第二高的薪水。如果不存在第二高的薪水，那么查询应返回 null。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+---------------------+</span><br>| SecondHighestSalary |<br><span class="hljs-code">+---------------------+</span><br>| 200                 |<br><span class="hljs-code">+---------------------+</span><br></code></pre></td></tr></table></figure><br>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/second-highest-salary">LeetCode</a></p>
<h4 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT<br>(<br>	SELECT DISTINCT Salary<br>	FROM Employee <br>	ORDER BY Salary DESC<br>	LIMIT 1 OFFSET 1<br>)<br>AS SecondHighestSalary<br></code></pre></td></tr></table></figure>
<h3 id="177-第N高的薪水"><a href="#177-第N高的薪水" class="headerlink" title="177. 第N高的薪水"></a>177. 第N高的薪水</h3><h4 id="题目-2"><a href="#题目-2" class="headerlink" title="题目"></a>题目</h4><p>编写一个 SQL 查询，获取 Employee 表中第 n 高的薪水（Salary）。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+----+</span>--------+<br>| Id | Salary |<br><span class="hljs-code">+----+</span>--------+<br>| 1  | 100    |<br>| 2  | 200    |<br>| 3  | 300    |<br><span class="hljs-code">+----+</span>--------+<br></code></pre></td></tr></table></figure><br>例如上述 Employee 表，n = 2 时，应返回第二高的薪水 200。如果不存在第 n 高的薪水，那么查询应返回 null。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+---------------------+</span><br>| SecondHighestSalary |<br><span class="hljs-code">+---------------------+</span><br>| 200                 |<br><span class="hljs-code">+---------------------+</span><br></code></pre></td></tr></table></figure><br>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/nth-highest-salary">LeetCode</a></p>
<h4 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT<br>BEGIN<br>  SET N &#x3D; N - 1;<br>  RETURN (<br>      # Write your MySQL query statement below.<br>      SELECT salary<br>      FROM employee<br>      GROUP BY salary<br>      ORDER BY salary DESC<br>      LIMIT N, 1<br>  );<br>END<br></code></pre></td></tr></table></figure>
<h3 id="178-分数排名"><a href="#178-分数排名" class="headerlink" title="178. 分数排名"></a>178. 分数排名</h3><h4 id="题目-3"><a href="#题目-3" class="headerlink" title="题目"></a>题目</h4><p>编写一个 SQL 查询来实现分数排名。</p>
<p>如果两个分数相同，则两个分数排名（Rank）相同。请注意，平分后的下一个名次应该是下一个连续的整数值。换句话说，名次之间不应该有“间隔”。<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">+----+-------+<br>|<span class="hljs-string"> Id </span>|<span class="hljs-string"> Score </span>|<br>+----+-------+<br>|<span class="hljs-string"> 1  </span>|<span class="hljs-string"> 3.50  </span>|<br>|<span class="hljs-string"> 2  </span>|<span class="hljs-string"> 3.65  </span>|<br>|<span class="hljs-string"> 3  </span>|<span class="hljs-string"> 4.00  </span>|<br>|<span class="hljs-string"> 4  </span>|<span class="hljs-string"> 3.85  </span>|<br>|<span class="hljs-string"> 5  </span>|<span class="hljs-string"> 4.00  </span>|<br>|<span class="hljs-string"> 6  </span>|<span class="hljs-string"> 3.65  </span>|<br>+----+-------+<br></code></pre></td></tr></table></figure><br>例如，根据上述给定的 Scores 表，你的查询应该返回（按分数从高到低排列）：<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">+-------+------+<br>|<span class="hljs-string"> Score </span>|<span class="hljs-string"> Rank </span>|<br>+-------+------+<br>|<span class="hljs-string"> 4.00  </span>|<span class="hljs-string"> 1    </span>|<br>|<span class="hljs-string"> 4.00  </span>|<span class="hljs-string"> 1    </span>|<br>|<span class="hljs-string"> 3.85  </span>|<span class="hljs-string"> 2    </span>|<br>|<span class="hljs-string"> 3.65  </span>|<span class="hljs-string"> 3    </span>|<br>|<span class="hljs-string"> 3.65  </span>|<span class="hljs-string"> 3    </span>|<br>|<span class="hljs-string"> 3.50  </span>|<span class="hljs-string"> 4    </span>|<br>+-------+------+<br></code></pre></td></tr></table></figure><br>重要提示：对于 MySQL 解决方案，如果要转义用作列名的保留字，可以在关键字之前和之后使用撇号。例如 `Rank`<br>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/rank-scores">LeetCode</a></p>
<h4 id="题解-3"><a href="#题解-3" class="headerlink" title="题解"></a>题解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT Score,DENSE_RANK() OVER(ORDER BY Score DESC) AS &#96;Rank&#96;<br>FROM Scores <br></code></pre></td></tr></table></figure>
<h3 id="180-连续出现的数字"><a href="#180-连续出现的数字" class="headerlink" title="180. 连续出现的数字"></a>180. 连续出现的数字</h3><h4 id="题目-4"><a href="#题目-4" class="headerlink" title="题目"></a>题目</h4><p>编写一个 SQL 查询，查找所有至少连续出现三次的数字。<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">+----+-----+<br>|<span class="hljs-string"> Id </span>|<span class="hljs-string"> Num </span>|<br>+----+-----+<br>|<span class="hljs-string"> 1  </span>|<span class="hljs-string">  1  </span>|<br>|<span class="hljs-string"> 2  </span>|<span class="hljs-string">  1  </span>|<br>|<span class="hljs-string"> 3  </span>|<span class="hljs-string">  1  </span>|<br>|<span class="hljs-string"> 4  </span>|<span class="hljs-string">  2  </span>|<br>|<span class="hljs-string"> 5  </span>|<span class="hljs-string">  1  </span>|<br>|<span class="hljs-string"> 6  </span>|<span class="hljs-string">  2  </span>|<br>|<span class="hljs-string"> 7  </span>|<span class="hljs-string">  2  </span>|<br>+----+-----+<br></code></pre></td></tr></table></figure><br>例如，给定上面的 Logs 表， 1 是唯一连续出现至少三次的数字。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+-----------------+</span><br>| ConsecutiveNums |<br><span class="hljs-code">+-----------------+</span><br>| 1               |<br><span class="hljs-code">+-----------------+</span><br></code></pre></td></tr></table></figure><br>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/consecutive-numbers">LeetCode</a></p>
<h4 id="题解-4"><a href="#题解-4" class="headerlink" title="题解"></a>题解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">方法一<br>SELECT DISTINCT A.Num AS ConsecutiveNums <br>FROM logs AS a<br>INNER JOIN logs AS B ON A.id+1 &#x3D; B.id AND A.Num &#x3D; B.Num<br>INNER JOIN logs AS C ON B.id+1 &#x3D; C.id AND B.Num &#x3D; C.Num<br><br>方法二<br>SELECT DISTINCT A.Num AS ConsecutiveNums <br>FROM logs AS A, logs AS B, logs AS C<br>WHERE A.id+1 &#x3D; B.id <br>    AND A.Num &#x3D; B.Num<br>    AND B.id+1 &#x3D; C.id <br>    AND B.Num &#x3D; C.Num<br></code></pre></td></tr></table></figure>
<h3 id="181-超过经理收入的员工"><a href="#181-超过经理收入的员工" class="headerlink" title="181. 超过经理收入的员工"></a>181. 超过经理收入的员工</h3><h4 id="题目-5"><a href="#题目-5" class="headerlink" title="题目"></a>题目</h4><p>Employee 表包含所有员工，他们的经理也属于员工。每个员工都有一个 Id，此外还有一列对应员工的经理的 Id。<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">+----+-------+--------+-----------+<br>|<span class="hljs-string"> Id </span>|<span class="hljs-string"> Name  </span>|<span class="hljs-string"> Salary </span>|<span class="hljs-string"> ManagerId </span>|<br>+----+-------+--------+-----------+<br>|<span class="hljs-string"> 1  </span>|<span class="hljs-string"> Joe   </span>|<span class="hljs-string"> 70000  </span>|<span class="hljs-string"> 3         </span>|<br>|<span class="hljs-string"> 2  </span>|<span class="hljs-string"> Henry </span>|<span class="hljs-string"> 80000  </span>|<span class="hljs-string"> 4         </span>|<br>|<span class="hljs-string"> 3  </span>|<span class="hljs-string"> Sam   </span>|<span class="hljs-string"> 60000  </span>|<span class="hljs-string"> NULL      </span>|<br>|<span class="hljs-string"> 4  </span>|<span class="hljs-string"> Max   </span>|<span class="hljs-string"> 90000  </span>|<span class="hljs-string"> NULL      </span>|<br>+----+-------+--------+-----------+<br></code></pre></td></tr></table></figure><br>给定 Employee 表，编写一个 SQL 查询，该查询可以获取收入超过他们经理的员工的姓名。在上面的表格中，Joe 是唯一一个收入超过他的经理的员工。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+----------+</span><br>| Employee |<br><span class="hljs-code">+----------+</span><br>| Joe      |<br><span class="hljs-code">+----------+</span><br></code></pre></td></tr></table></figure><br>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/employees-earning-more-than-their-managers">LeetCode</a></p>
<h4 id="题解-5"><a href="#题解-5" class="headerlink" title="题解"></a>题解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT A.Name As Employee <br>FROM Employee AS A, Employee AS B<br>WHERE A.MAnagerId &#x3D; B.Id<br>    AND A.Salary &gt; B.Salary<br></code></pre></td></tr></table></figure>
<h3 id="182-查找重复的电子邮箱"><a href="#182-查找重复的电子邮箱" class="headerlink" title="182. 查找重复的电子邮箱"></a>182. 查找重复的电子邮箱</h3><h4 id="题目-6"><a href="#题目-6" class="headerlink" title="题目"></a>题目</h4><p>编写一个 SQL 查询，查找 Person 表中所有重复的电子邮箱。</p>
<p>示例：<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+----+</span>---------+<br>| Id | Email   |<br><span class="hljs-code">+----+</span>---------+<br>| 1  | a@b.com |<br>| 2  | c@d.com |<br>| 3  | a@b.com |<br><span class="hljs-code">+----+</span>---------+<br></code></pre></td></tr></table></figure><br>根据以上输入，你的查询应返回以下结果：<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+---------+</span><br>| Email   |<br><span class="hljs-code">+---------+</span><br>| a@b.com |<br><span class="hljs-code">+---------+</span><br></code></pre></td></tr></table></figure><br>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/duplicate-emails">LeetCode</a></p>
<h4 id="题解-6"><a href="#题解-6" class="headerlink" title="题解"></a>题解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT DISTINCT A.Email<br>FROM Person AS A, Person AS B<br>WHERE A.Email &#x3D; B.Email<br>    AND A.ID !&#x3D; B.Id<br></code></pre></td></tr></table></figure>
<h3 id="183-从不订购的客户"><a href="#183-从不订购的客户" class="headerlink" title="183. 从不订购的客户"></a>183. 从不订购的客户</h3><h4 id="题目-7"><a href="#题目-7" class="headerlink" title="题目"></a>题目</h4><p>某网站包含两个表，Customers 表和 Orders 表。编写一个 SQL 查询，找出所有从不订购任何东西的客户。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">Customers 表：<br><span class="hljs-code">+----+</span>-------+<br>| Id | Name  |<br><span class="hljs-code">+----+</span>-------+<br>| 1  | Joe   |<br>| 2  | Henry |<br>| 3  | Sam   |<br>| 4  | Max   |<br><span class="hljs-code">+----+</span>-------+<br>Orders 表：<br><span class="hljs-code">+----+</span>------------+<br>| Id | CustomerId |<br><span class="hljs-code">+----+</span>------------+<br>| 1  | 3          |<br>| 2  | 1          |<br><span class="hljs-code">+----+</span>------------+<br></code></pre></td></tr></table></figure><br>例如给定上述表格，你的查询应返回：<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+-----------+</span><br>| Customers |<br><span class="hljs-code">+-----------+</span><br>| Henry     |<br>| Max       |<br><span class="hljs-code">+-----------+</span><br></code></pre></td></tr></table></figure><br>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/customers-who-never-order">LeetCode</a></p>
<h4 id="题解-7"><a href="#题解-7" class="headerlink" title="题解"></a>题解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT Name AS Customers <br>FROM Customers <br>WHERE Id NOT IN <br>(<br>    SELECT CustomerId FROM Orders <br>)<br></code></pre></td></tr></table></figure>
<h3 id="184-部门工资最高的员工"><a href="#184-部门工资最高的员工" class="headerlink" title="184. 部门工资最高的员工"></a>184. 部门工资最高的员工</h3><h4 id="题目-8"><a href="#题目-8" class="headerlink" title="题目"></a>题目</h4><p>Employee 表包含所有员工信息，每个员工有其对应的 Id, salary 和 department Id。<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">+----+-------+--------+--------------+<br>|<span class="hljs-string"> Id </span>|<span class="hljs-string"> Name  </span>|<span class="hljs-string"> Salary </span>|<span class="hljs-string"> DepartmentId </span>|<br>+----+-------+--------+--------------+<br>|<span class="hljs-string"> 1  </span>|<span class="hljs-string"> Joe   </span>|<span class="hljs-string"> 70000  </span>|<span class="hljs-string"> 1            </span>|<br>|<span class="hljs-string"> 2  </span>|<span class="hljs-string"> Jim   </span>|<span class="hljs-string"> 90000  </span>|<span class="hljs-string"> 1            </span>|<br>|<span class="hljs-string"> 3  </span>|<span class="hljs-string"> Henry </span>|<span class="hljs-string"> 80000  </span>|<span class="hljs-string"> 2            </span>|<br>|<span class="hljs-string"> 4  </span>|<span class="hljs-string"> Sam   </span>|<span class="hljs-string"> 60000  </span>|<span class="hljs-string"> 2            </span>|<br>|<span class="hljs-string"> 5  </span>|<span class="hljs-string"> Max   </span>|<span class="hljs-string"> 90000  </span>|<span class="hljs-string"> 1            </span>|<br>+----+-------+--------+--------------+<br></code></pre></td></tr></table></figure><br>Department 表包含公司所有部门的信息。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+----+</span>----------+<br>| Id | Name     |<br><span class="hljs-code">+----+</span>----------+<br>| 1  | IT       |<br>| 2  | Sales    |<br><span class="hljs-code">+----+</span>----------+<br></code></pre></td></tr></table></figure><br>编写一个 SQL 查询，找出每个部门工资最高的员工。对于上述表，您的 SQL 查询应返回以下行（行的顺序无关紧要）。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+------------+</span>----------<span class="hljs-code">+--------+</span><br>| Department | Employee | Salary |<br><span class="hljs-code">+------------+</span>----------<span class="hljs-code">+--------+</span><br>| IT         | Max      | 90000  |<br>| IT         | Jim      | 90000  |<br>| Sales      | Henry    | 80000  |<br><span class="hljs-code">+------------+</span>----------<span class="hljs-code">+--------+</span><br></code></pre></td></tr></table></figure><br>解释：<br>Max 和 Jim 在 IT 部门的工资都是最高的，Henry 在销售部的工资最高。</p>
<p>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/department-highest-salary">LeetCode</a></p>
<h4 id="题解-8"><a href="#题解-8" class="headerlink" title="题解"></a>题解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT Department.Name AS &#96;Department&#96;, Employee .Name AS &#96;Employee&#96;, Salary<br>FROM Employee<br>JOIN Department ON Employee.DepartmentId &#x3D; Department.Id<br>WHERE (Employee.DepartmentId , Salary) IN<br>(<br>    SELECT DepartmentId, MAX(Salary)<br>    FROM Employee<br>    GROUP BY DepartmentId<br>)<br></code></pre></td></tr></table></figure>
<h3 id="185-部门工资前三高的所有员工"><a href="#185-部门工资前三高的所有员工" class="headerlink" title="185. 部门工资前三高的所有员工"></a>185. 部门工资前三高的所有员工</h3><h4 id="题目-9"><a href="#题目-9" class="headerlink" title="题目"></a>题目</h4><p>Employee 表包含所有员工信息，每个员工有其对应的工号 Id，姓名 Name，工资 Salary 和部门编号 DepartmentId 。<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">+----+-------+--------+--------------+<br>|<span class="hljs-string"> Id </span>|<span class="hljs-string"> Name  </span>|<span class="hljs-string"> Salary </span>|<span class="hljs-string"> DepartmentId </span>|<br>+----+-------+--------+--------------+<br>|<span class="hljs-string"> 1  </span>|<span class="hljs-string"> Joe   </span>|<span class="hljs-string"> 85000  </span>|<span class="hljs-string"> 1            </span>|<br>|<span class="hljs-string"> 2  </span>|<span class="hljs-string"> Henry </span>|<span class="hljs-string"> 80000  </span>|<span class="hljs-string"> 2            </span>|<br>|<span class="hljs-string"> 3  </span>|<span class="hljs-string"> Sam   </span>|<span class="hljs-string"> 60000  </span>|<span class="hljs-string"> 2            </span>|<br>|<span class="hljs-string"> 4  </span>|<span class="hljs-string"> Max   </span>|<span class="hljs-string"> 90000  </span>|<span class="hljs-string"> 1            </span>|<br>|<span class="hljs-string"> 5  </span>|<span class="hljs-string"> Janet </span>|<span class="hljs-string"> 69000  </span>|<span class="hljs-string"> 1            </span>|<br>|<span class="hljs-string"> 6  </span>|<span class="hljs-string"> Randy </span>|<span class="hljs-string"> 85000  </span>|<span class="hljs-string"> 1            </span>|<br>|<span class="hljs-string"> 7  </span>|<span class="hljs-string"> Will  </span>|<span class="hljs-string"> 70000  </span>|<span class="hljs-string"> 1            </span>|<br>+----+-------+--------+--------------+<br></code></pre></td></tr></table></figure><br>Department 表包含公司所有部门的信息。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+----+</span>----------+<br>| Id | Name     |<br><span class="hljs-code">+----+</span>----------+<br>| 1  | IT       |<br>| 2  | Sales    |<br><span class="hljs-code">+----+</span>----------+<br></code></pre></td></tr></table></figure><br>编写一个 SQL 查询，找出每个部门获得前三高工资的所有员工。例如，根据上述给定的表，查询结果应返回：<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">+------------+----------+--------+<br>|<span class="hljs-string"> Department </span>|<span class="hljs-string"> Employee </span>|<span class="hljs-string"> Salary </span>|<br>+------------+----------+--------+<br>|<span class="hljs-string"> IT         </span>|<span class="hljs-string"> Max      </span>|<span class="hljs-string"> 90000  </span>|<br>|<span class="hljs-string"> IT         </span>|<span class="hljs-string"> Randy    </span>|<span class="hljs-string"> 85000  </span>|<br>|<span class="hljs-string"> IT         </span>|<span class="hljs-string"> Joe      </span>|<span class="hljs-string"> 85000  </span>|<br>|<span class="hljs-string"> IT         </span>|<span class="hljs-string"> Will     </span>|<span class="hljs-string"> 70000  </span>|<br>|<span class="hljs-string"> Sales      </span>|<span class="hljs-string"> Henry    </span>|<span class="hljs-string"> 80000  </span>|<br>|<span class="hljs-string"> Sales      </span>|<span class="hljs-string"> Sam      </span>|<span class="hljs-string"> 60000  </span>|<br>+------------+----------+--------+<br></code></pre></td></tr></table></figure><br>解释：<br>IT 部门中，Max 获得了最高的工资，Randy 和 Joe 都拿到了第二高的工资，Will 的工资排第三。销售部门（Sales）只有两名员工，Henry 的工资最高，Sam 的工资排第二。</p>
<p>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/department-top-three-salaries">LeetCode</a></p>
<h4 id="题解-9"><a href="#题解-9" class="headerlink" title="题解"></a>题解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT D.Name AS &#96;Department&#96;, E1.Name AS &#96;Employee&#96;, Salary<br>FROM Employee AS E1<br>JOIN Department AS D ON E1.DepartmentId &#x3D; D.Id<br>WHERE (<br>    SELECT COUNT(DISTINCT E2.Salary)<br>    FROM Employee AS E2<br>    WHERE E1.Salary &lt; E2.Salary<br>        AND E1.DepartmentId &#x3D; E2.DepartmentId<br>) &lt; 3<br></code></pre></td></tr></table></figure>
<h3 id="196-删除重复的电子邮箱"><a href="#196-删除重复的电子邮箱" class="headerlink" title="196. 删除重复的电子邮箱"></a>196. 删除重复的电子邮箱</h3><h4 id="题目-10"><a href="#题目-10" class="headerlink" title="题目"></a>题目</h4><p>编写一个 SQL 查询，来删除 Person 表中所有重复的电子邮箱，重复的邮箱里只保留 Id 最小 的那个。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+----+</span>------------------+<br>| Id | Email            |<br><span class="hljs-code">+----+</span>------------------+<br>| 1  | john@example.com |<br>| 2  | bob@example.com  |<br>| 3  | john@example.com |<br><span class="hljs-code">+----+</span>------------------+<br></code></pre></td></tr></table></figure><br>Id 是这个表的主键。<br>例如，在运行你的查询语句之后，上面的 Person 表应返回以下几行:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+----+</span>------------------+<br>| Id | Email            |<br><span class="hljs-code">+----+</span>------------------+<br>| 1  | john@example.com |<br>| 2  | bob@example.com  |<br><span class="hljs-code">+----+</span>------------------+<br></code></pre></td></tr></table></figure><br>提示：</p>
<ul>
<li>执行 SQL 之后，输出是整个 Person 表。</li>
<li>使用 delete 语句。<br>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/delete-duplicate-emails">LeetCode</a><h4 id="题解-10"><a href="#题解-10" class="headerlink" title="题解"></a>题解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELETE A FROM Person A,<br>    Person B<br>WHERE<br>    A.Email &#x3D; B.Email <br>    AND A.Id &gt; B.Id<br></code></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="197-上升的温度"><a href="#197-上升的温度" class="headerlink" title="197. 上升的温度"></a>197. 上升的温度</h3><h4 id="题目-11"><a href="#题目-11" class="headerlink" title="题目"></a>题目</h4><p>给定一个 Weather 表，编写一个 SQL 查询，来查找与之前（昨天的）日期相比温度更高的所有日期的 Id。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+---------+</span>------------------<span class="hljs-code">+------------------+</span><br>| Id(INT) | RecordDate(DATE) | Temperature(INT) |<br><span class="hljs-code">+---------+</span>------------------<span class="hljs-code">+------------------+</span><br>|       1 |       2015-01-01 |               10 |<br>|       2 |       2015-01-02 |               25 |<br>|       3 |       2015-01-03 |               20 |<br>|       4 |       2015-01-04 |               30 |<br><span class="hljs-code">+---------+</span>------------------<span class="hljs-code">+------------------+</span><br></code></pre></td></tr></table></figure><br>例如，根据上述给定的 Weather 表格，返回如下 Id:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+----+</span><br>| Id |<br><span class="hljs-code">+----+</span><br>|  2 |<br>|  4 |<br><span class="hljs-code">+----+</span><br></code></pre></td></tr></table></figure><br>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/rising-temperature">LeetCode</a></p>
<h4 id="题解-11"><a href="#题解-11" class="headerlink" title="题解"></a>题解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT A.Id <br>FROM Weather AS A, Weather AS B<br>WHERE DATEDIFF(A.RecordDate, B.RecordDate) &#x3D; 1<br>    AND A.Temperature &gt; B.Temperature<br></code></pre></td></tr></table></figure>
<h3 id="262-行程和用户"><a href="#262-行程和用户" class="headerlink" title="262. 行程和用户"></a>262. 行程和用户</h3><h4 id="题目-12"><a href="#题目-12" class="headerlink" title="题目"></a>题目</h4><p>Trips 表中存所有出租车的行程信息。每段行程有唯一键 Id，Client_Id 和 Driver_Id 是 Users 表中 Users_Id 的外键。Status 是枚举类型，枚举成员为 `(‘completed’, ‘cancelled_by_driver’, ‘cancelled_by_client’)。<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">+----+-----------+-----------+---------+--------------------+----------+<br>|<span class="hljs-string"> Id </span>|<span class="hljs-string"> Client_Id </span>|<span class="hljs-string"> Driver_Id </span>|<span class="hljs-string"> City_Id </span>|<span class="hljs-string">        Status      </span>|<span class="hljs-string">Request_at</span>|<br>+----+-----------+-----------+---------+--------------------+----------+<br>|<span class="hljs-string"> 1  </span>|<span class="hljs-string">     1     </span>|<span class="hljs-string">    10     </span>|<span class="hljs-string">    1    </span>|<span class="hljs-string">     completed      </span>|<span class="hljs-string">2013-10-01</span>|<br>|<span class="hljs-string"> 2  </span>|<span class="hljs-string">     2     </span>|<span class="hljs-string">    11     </span>|<span class="hljs-string">    1    </span>|<span class="hljs-string"> cancelled_by_driver</span>|<span class="hljs-string">2013-10-01</span>|<br>|<span class="hljs-string"> 3  </span>|<span class="hljs-string">     3     </span>|<span class="hljs-string">    12     </span>|<span class="hljs-string">    6    </span>|<span class="hljs-string">     completed      </span>|<span class="hljs-string">2013-10-01</span>|<br>|<span class="hljs-string"> 4  </span>|<span class="hljs-string">     4     </span>|<span class="hljs-string">    13     </span>|<span class="hljs-string">    6    </span>|<span class="hljs-string"> cancelled_by_client</span>|<span class="hljs-string">2013-10-01</span>|<br>|<span class="hljs-string"> 5  </span>|<span class="hljs-string">     1     </span>|<span class="hljs-string">    10     </span>|<span class="hljs-string">    1    </span>|<span class="hljs-string">     completed      </span>|<span class="hljs-string">2013-10-02</span>|<br>|<span class="hljs-string"> 6  </span>|<span class="hljs-string">     2     </span>|<span class="hljs-string">    11     </span>|<span class="hljs-string">    6    </span>|<span class="hljs-string">     completed      </span>|<span class="hljs-string">2013-10-02</span>|<br>|<span class="hljs-string"> 7  </span>|<span class="hljs-string">     3     </span>|<span class="hljs-string">    12     </span>|<span class="hljs-string">    6    </span>|<span class="hljs-string">     completed      </span>|<span class="hljs-string">2013-10-02</span>|<br>|<span class="hljs-string"> 8  </span>|<span class="hljs-string">     2     </span>|<span class="hljs-string">    12     </span>|<span class="hljs-string">    12   </span>|<span class="hljs-string">     completed      </span>|<span class="hljs-string">2013-10-03</span>|<br>|<span class="hljs-string"> 9  </span>|<span class="hljs-string">     3     </span>|<span class="hljs-string">    10     </span>|<span class="hljs-string">    12   </span>|<span class="hljs-string">     completed      </span>|<span class="hljs-string">2013-10-03</span>|<span class="hljs-string"> </span><br>|<span class="hljs-string"> 10 </span>|<span class="hljs-string">     4     </span>|<span class="hljs-string">    13     </span>|<span class="hljs-string">    12   </span>|<span class="hljs-string"> cancelled_by_driver</span>|<span class="hljs-string">2013-10-03</span>|<br>+----+-----------+-----------+---------+--------------------+----------+<br></code></pre></td></tr></table></figure><br>Users 表存所有用户。每个用户有唯一键 Users_Id。Banned 表示这个用户是否被禁止，Role 则是一个表示（‘client’, ‘driver’, ‘partner’）的枚举类型。<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">+----------+--------+--------+<br>|<span class="hljs-string"> Users_Id </span>|<span class="hljs-string"> Banned </span>|<span class="hljs-string">  Role  </span>|<br>+----------+--------+--------+<br>|<span class="hljs-string">    1     </span>|<span class="hljs-string">   No   </span>|<span class="hljs-string"> client </span>|<br>|<span class="hljs-string">    2     </span>|<span class="hljs-string">   Yes  </span>|<span class="hljs-string"> client </span>|<br>|<span class="hljs-string">    3     </span>|<span class="hljs-string">   No   </span>|<span class="hljs-string"> client </span>|<br>|<span class="hljs-string">    4     </span>|<span class="hljs-string">   No   </span>|<span class="hljs-string"> client </span>|<br>|<span class="hljs-string">    10    </span>|<span class="hljs-string">   No   </span>|<span class="hljs-string"> driver </span>|<br>|<span class="hljs-string">    11    </span>|<span class="hljs-string">   No   </span>|<span class="hljs-string"> driver </span>|<br>|<span class="hljs-string">    12    </span>|<span class="hljs-string">   No   </span>|<span class="hljs-string"> driver </span>|<br>|<span class="hljs-string">    13    </span>|<span class="hljs-string">   No   </span>|<span class="hljs-string"> driver </span>|<br>+----------+--------+--------+<br></code></pre></td></tr></table></figure><br>写一段 SQL 语句查出 2013年10月1日 至 2013年10月3日 期间非禁止用户的取消率。基于上表，你的 SQL 语句应返回如下结果，取消率（Cancellation Rate）保留两位小数。</p>
<p>取消率的计算方式如下：(被司机或乘客取消的非禁止用户生成的订单数量) / (非禁止用户生成的订单总数)<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">+------------+</span>-------------------+<br>|     Day    | Cancellation Rate |<br><span class="hljs-code">+------------+</span>-------------------+<br>| 2013-10-01 |       0.33        |<br>| 2013-10-02 |       0.00        |<br>| 2013-10-03 |       0.50        |<br><span class="hljs-code">+------------+</span>-------------------+<br></code></pre></td></tr></table></figure><br>来源：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/trips-and-users">LeetCode</a></p>
<h4 id="题解-12"><a href="#题解-12" class="headerlink" title="题解"></a>题解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT <br>    Request_at AS Day, <br>    ROUND(AVG(Status!&#x3D;&#39;completed&#39;), 2) AS &#39;Cancellation Rate&#39;<br>FROM Trips AS T<br>JOIN Users AS U1 ON T.Client_Id  &#x3D; U1.Users_Id AND U1.Banned &#x3D; &quot;No&quot;<br>JOIN Users AS U2 ON T.Driver_Id  &#x3D; U2.Users_Id AND U2.Banned &#x3D; &quot;No&quot;    <br>WHERE request_at BETWEEN &#39;2013-10-01&#39; AND &#39;2013-10-03&#39;<br>GROUP BY Request_at<br></code></pre></td></tr></table></figure>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/SQL/">SQL</a>
                    
                      <a class="hover-with-bg" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/sql-on-leetcode-2/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">LeetCode部分SQL习题（二）</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/character-strengths/">
                        <span class="hidden-mobile">24种性格力量测试</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    document.addEventListener('DOMContentLoaded', function() {
      window.NProgress && window.NProgress.inc();
    })
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>





  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
